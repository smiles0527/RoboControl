<UserControl x:Class="ControlWorkbench.App.Views.ToolsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="700" d:DesignWidth="1200">
    
    <Grid Margin="5">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="400"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        
        <!-- Left: Input Panels -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel>
                <TextBlock Text="Tools and Calibration" Style="{StaticResource HeaderTextStyle}"/>
                
                <!-- Encoder Calculator -->
                <GroupBox Header="Encoder Calculator">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="PPR:" VerticalAlignment="Center" Margin="3" ToolTip="Pulses Per Revolution"/>
                            <TextBox Grid.Column="1" Text="{Binding EncoderPpr}" Margin="3"/>
                            <CheckBox Grid.Column="2" Grid.ColumnSpan="2" Content="Quadrature (4x)" 
                                      IsChecked="{Binding QuadratureDecoding}" Margin="3" VerticalAlignment="Center"/>
                            
                            <TextBlock Grid.Row="1" Text="Wheel R (m):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding WheelRadius}" Margin="3"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Gear Ratio:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding GearRatio}" Margin="3"/>
                            
                            <TextBlock Grid.Row="2" Text="Sample Rate:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding EncoderSampleRate}" Margin="3"/>
                        </Grid>
                        <Button Content="Calculate" Command="{Binding ComputeEncoderCommand}" 
                                HorizontalAlignment="Left" Margin="3"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Odometry Calculator -->
                <GroupBox Header="Odometry Calculator">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Track Width (m):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="1" Text="{Binding TrackWidth}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="Left Counts:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding LeftEncoderCounts}" Margin="3"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Right Counts:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding RightEncoderCounts}" Margin="3"/>
                        </Grid>
                        <TextBlock Margin="3" FontFamily="Consolas" FontSize="11" 
                                   Text="{Binding OdomPoseX, StringFormat='Pose: X={0:F3} m'}"/>
                        <StackPanel Orientation="Horizontal" Margin="3">
                            <Button Content="Update Odometry" Command="{Binding ComputeOdometryCommand}"/>
                            <Button Content="Reset" Command="{Binding ResetOdometryCommand}"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- Unit Converter -->
                <GroupBox Header="Unit Converter">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Value:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="1" Text="{Binding InputValue}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="Conversion:" VerticalAlignment="Center" Margin="3"/>
                            <ComboBox Grid.Row="1" Grid.Column="1" ItemsSource="{Binding ConversionTypes}" 
                                      SelectedItem="{Binding SelectedConversion}" Margin="3"/>
                        </Grid>
                        <StackPanel Orientation="Horizontal" Margin="3">
                            <Button Content="Convert" Command="{Binding ConvertUnitsCommand}"/>
                            <TextBlock Text="{Binding ConversionResult}" VerticalAlignment="Center" 
                                       Margin="10,0,0,0" FontWeight="Bold" FontSize="12"/>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>
                
                <!-- Motor Calculator -->
                <GroupBox Header="Motor Calculator">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Kt (Nm/A):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="1" Text="{Binding MotorKt}" Margin="3"/>
                            <TextBlock Grid.Column="2" Text="Ke (V/rad/s):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="3" Text="{Binding MotorKe}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="R (Ohm):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding MotorR}" Margin="3"/>
                            
                            <TextBlock Grid.Row="2" Text="Voltage (V):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding MotorVoltage}" Margin="3"/>
                            <TextBlock Grid.Row="2" Grid.Column="2" Text="Current (A):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding MotorCurrent}" Margin="3"/>
                        </Grid>
                        <Button Content="Calculate" Command="{Binding ComputeMotorCommand}" 
                                HorizontalAlignment="Left" Margin="3"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- System Identification -->
                <GroupBox Header="System ID / Test Data">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="System Type:" VerticalAlignment="Center" Margin="3"/>
                            <ComboBox Grid.Column="1" ItemsSource="{Binding SystemTypes}" 
                                      SelectedItem="{Binding SelectedSystemType}" Margin="3"/>
                            <TextBlock Grid.Column="2" Text="Gain:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="3" Text="{Binding SysIdGain}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="Tau (1st order):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SysIdTimeConstant}" Margin="3"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Wn (2nd):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding SysIdNaturalFreq}" Margin="3"/>
                            
                            <TextBlock Grid.Row="2" Text="Zeta (damping):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding SysIdDamping}" Margin="3"/>
                            <TextBlock Grid.Row="2" Grid.Column="2" Text="Noise:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="2" Grid.Column="3" Text="{Binding SysIdNoiseLevel}" Margin="3"/>
                            
                            <TextBlock Grid.Row="3" Text="Step:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding SysIdStepMagnitude}" Margin="3"/>
                            <TextBlock Grid.Row="3" Grid.Column="2" Text="Duration:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="3" Grid.Column="3" Text="{Binding SysIdDuration}" Margin="3"/>
                        </Grid>
                        <Button Content="Generate and Identify" Command="{Binding GenerateTestDataCommand}" 
                                HorizontalAlignment="Left" Margin="3"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- FFT Analysis -->
                <GroupBox Header="FFT Analysis">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Signal Freq (Hz):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="1" Text="{Binding FftSignalFreq}" Margin="3"/>
                            <TextBlock Grid.Column="2" Text="Sample Rate:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="3" Text="{Binding FftSampleRate}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="Duration (s):" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding FftDuration}" Margin="3"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Window:" VerticalAlignment="Center" Margin="3"/>
                            <ComboBox Grid.Row="1" Grid.Column="3" ItemsSource="{Binding WindowTypes}" 
                                      SelectedItem="{Binding SelectedWindow}" Margin="3"/>
                        </Grid>
                        <Button Content="Compute FFT" Command="{Binding ComputeFftCommand}" 
                                HorizontalAlignment="Left" Margin="3"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Navigation Calculator -->
                <GroupBox Header="GPS Navigation">
                    <StackPanel>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition/>
                                <RowDefinition/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Text="Lat 1:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="1" Text="{Binding Lat1}" Margin="3"/>
                            <TextBlock Grid.Column="2" Text="Lon 1:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Column="3" Text="{Binding Lon1}" Margin="3"/>
                            
                            <TextBlock Grid.Row="1" Text="Lat 2:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Lat2}" Margin="3"/>
                            <TextBlock Grid.Row="1" Grid.Column="2" Text="Lon 2:" VerticalAlignment="Center" Margin="3"/>
                            <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding Lon2}" Margin="3"/>
                        </Grid>
                        <Button Content="Calculate" Command="{Binding ComputeNavigationCommand}" 
                                HorizontalAlignment="Left" Margin="3"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Right: Results Panel -->
        <TabControl Grid.Column="1" Margin="5,0,0,0">
            <TabItem Header="Encoder">
                <TextBox Text="{Binding EncoderResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="Odometry">
                <TextBox Text="{Binding OdometryResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="Motor">
                <TextBox Text="{Binding MotorResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="System ID">
                <TextBox Text="{Binding SysIdResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="FFT">
                <TextBox Text="{Binding FftResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
            <TabItem Header="Navigation">
                <TextBox Text="{Binding NavigationResult, Mode=OneWay}" 
                         Style="{StaticResource MonospaceTextBox}" IsReadOnly="True"/>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
